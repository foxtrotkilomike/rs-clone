(()=>{"use strict";const e=document.querySelector(".burger"),t=document.querySelector(".navbar__list"),s=[...document.querySelectorAll(".nav__link")];function i(){document.body.style.overflow="auto",document.body.style.userSelect="auto"}const a=e=>{const t=document.getElementById(e).querySelectorAll(".tabs-nav__item"),s=document.getElementById(e).querySelectorAll(".tabs-content__item");let i="";t.forEach((e=>e.addEventListener("click",(e=>a(e)))));const a=e=>{e.preventDefault(),t.forEach((e=>e.classList.remove("is-active")));const a=e.target.classList.contains("tabs-nav__item")?e.target:e.target.closest(".tabs-nav__item");var n;a?.classList.add("is-active"),s.forEach((e=>e.classList.remove("is-active"))),i=a?.getAttribute("data-tab-name"),n=i,s.forEach((e=>{e.getAttribute("data-tab-content")===n?e.classList.add("is-active"):e.classList.remove("is-active")}))}},n=async function(e,t){return await t(e.queryOptions)},c="https://rs-recipes-server.herokuapp.com",r=e=>{const t=[];for(const[s,i]of Object.entries(e))switch(typeof s){case"string":case"number":case"boolean":t.push(`${s}=${i}`);break;case"object":t.push(`${s}=${i.join(",")}`)}return"?"+t.join("&")},o=async e=>{let t="";e&&0!==Object.keys(e).length&&(t=r(e));const s=await fetch(`${c}/recipes/${t}`);return await s.json()},l=async e=>{let t="";e&&0!==Object.keys(e).length&&(t=r(e));const s=await fetch(`${c}/articles/${t}`);return await s.json()},d=function(e,...t){const s=document.createElement(e);return s.classList.add(...t),s},u=function(e,t,s){return e?[!!e[t].saved.find((e=>e===s)),!!e[t].favorite.find((e=>e===s))]:[!1,!1]};function p(e,t,s){const i=document.querySelector(`.${t.containerClass}`).querySelector(`.${t.listClass}`),a=function(e,t,s){return e.map(((e,i)=>"largeCardIndex"in t?function(e,t,s,i,a){const n=e.dishTypes[0].split(" ").map((e=>e[0].toUpperCase()+e.slice(1))).join(" ")||"",c=Math.round(e.nutrition.nutrients[0].amount),r=String(e.id),o=`./recipe.html?id=${r}`,[l,p]=u(a,"recipes",r),m="normal"===t?s.concat("card"):s.concat(["card","card_lg"]),v=d(i,...m);return v.id=r,v.innerHTML=`\n    <div class="card__header">\n      <p class="card__dish">${n}</p>\n      <div class="recipe__btns">\n        <button class="save-recipe btn-reset save-btn"></button>\n        <button class="favorite-recipe btn-reset favorite-btn"></button>\n      </div>\n    </div>\n    <a class="card__img" href="${o}">\n      <img class="card__img" src=${e.image} alt=${e.title}>\n    </a>\n    <a class="card-anchor" href=${o}>\n      <div class="card__meta">\n        <div class="data__time">\n          <p class="time__title">Cook time</p>\n          <p class="time__info">${e.readyInMinutes} min</p>\n        </div>\n        <div class="data__calories">\n          <p class="calories__title">Calories</p>\n          <p class="calories__info">${c} kcal</p>\n        </div>\n        <div class="data__rating">\n          <p class="rating__title">Rating</p>\n          <p class="rating__info">${e.aggregateLikes}</p>\n        </div>\n      </div>\n      <div class="card__body">\n        <h3 class="card__title">${e.title}</h3>\n        <p class="card__text">${e.summary}</p>\n      </div>\n    </a>\n  `,l&&v.querySelector(".save-recipe").classList.add("is-active"),p&&v.querySelector(".favorite-recipe").classList.add("is-active"),v}(e,i===t.largeCardIndex?"large":"normal",t.cardClassList,t.listElemType,s):function(e,t,s){const i=new Date(e.postedAt).toLocaleDateString("en-us",{year:"numeric",month:"long",day:"numeric"}),a=String(e._id),n=`./article.html?id=${a}`,[c,r]=u(s,"articles",a),o=d("article",...t);return o.id=e._id,o.innerHTML=`\n    <img class="article__img" src=${e.image} alt="article preview">\n    <div class="article__content">\n      <div class="article__header">\n        <time class="article__date" datetime=${e.postedAt}>${i}</time>\n        <div class="article__btns">\n          <button class="save-article btn-reset save-btn"></button>\n          <button class="favorite-article btn-reset favorite-btn"></button>\n        </div>\n      </div>\n      <h3 class="article__title">${e.title}</h3>\n      <p class="article__summary">${e.summary}</p>\n      <a class="article__btn btn-reset" href=${n}>contunue reading</a>\n    </div>\n  `,c&&o.querySelector(".save-article").classList.add("is-active"),r&&o.querySelector(".favorite-article").classList.add("is-active"),o}(e,t.articleClassList,s)))}(e,t,s);i.innerHTML="",i.append(...a)}function m(e){window.localStorage.userName=e,document.querySelector("#user-name").textContent=e}function v(e){window.localStorage.setItem("user",JSON.stringify(e))}async function g(e){e.preventDefault();const t=e.target,s=function(e){if(e.password.value===e["password-confirm"].value)return e.querySelector("#password-mismatch").classList.add("hidden"),e.querySelector("#user-exist").classList.add("hidden"),new FormData(e);e.querySelector("#password-mismatch").classList.remove("hidden")}(e.target);if(void 0!==s){const e=await _(s,"/user/register");if(400===e.status)t.querySelector("#user-exist").classList.remove("hidden");else{document.querySelector(".popup").classList.remove("is-open"),alert("Registered successfully!"),localStorage.setItem("token","true"),t.reset();const s=await e.json();v(s),m(s.name)}}}async function y(e){e.preventDefault();const t=e.target,s=(i=e.target,new FormData(i));var i;const a=await _(s,"/user/login");switch(a.status){case 401:t.querySelector("#wrong-password").classList.remove("hidden"),t.querySelector("#user-not-found").classList.add("hidden");break;case 404:case 500:t.querySelector("#user-not-found").classList.remove("hidden"),t.querySelector("#wrong-password").classList.add("hidden");break;case 200:{document.querySelector(".popup").classList.remove("is-open"),alert("Logged in successfully!"),localStorage.setItem("token","true"),t.reset();const e=await a.json();v(e),m(e.name)}}}async function _(e,t){return await fetch(`${c}${t}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(Object.fromEntries(e.entries()))})}function f(e){if(void 0!==e)return[{saved:{containerClass:"recipes-saved",listClass:"recipes__list",listElemType:"li",cardClassList:["recipe__item"],queryOptions:{page:0,limit:10,id:e.recipes.saved},largeCardIndex:-1},favorite:{containerClass:"recipes-favorite",listClass:"recipes__list",listElemType:"li",cardClassList:["recipe__item"],queryOptions:{page:0,limit:10,id:e.recipes.favorite},largeCardIndex:-1}},{saved:{containerClass:"articles-saved",listClass:"articles__list",articleClassList:["article"],queryOptions:{page:0,limit:8,id:e.articles.saved}},favorite:{containerClass:"articles-favorite",listClass:"articles__list",articleClassList:["article"],queryOptions:{page:0,limit:8,id:e.articles.favorite}}}]}function L(){(()=>{const e=document.getElementById("userpage-controls").querySelectorAll(".tabs-btn"),t=document.querySelectorAll(".tabs");e.forEach((s=>{s.addEventListener("click",(()=>{e.forEach((e=>{e.classList.remove("btn-active")})),s.classList.add("btn-active");const i=s?.getAttribute("data-link-to");!function(e){t.forEach((t=>{t.id===e?t.classList.remove("hidden"):t.classList.add("hidden"),a(t.id)}))}(i)}))}))})(),S.addEventListener("click",(()=>async function(){204===(await fetch(`${c}/user/logout`,{credentials:"include"})).status&&(localStorage.removeItem("userName"),localStorage.removeItem("user"),localStorage.removeItem("token"),window.open("./index.html","_self"))}())),h(),M(),function(){const e=document.querySelector(".profile-btn"),t=document.querySelector(".popup");e.addEventListener("click",(async()=>{if(localStorage.getItem("token")){const e=await fetch(`${c}/user/profile`,{credentials:"include"});200===e.status?(v(await e.json()),window.open("./user-page.html","_self")):t.classList.add("is-open")}else t.classList.add("is-open")}))}(),document.forms[1].addEventListener("submit",g),document.forms[0].addEventListener("submit",y)}const S=document.getElementById("logout-btn");function h(){document.querySelectorAll(".article").forEach((e=>{N(e,"articles")}))}function M(){document.querySelectorAll(".card").forEach((e=>{N(e,"recipes")}))}function N(e,t){const s=e.querySelector(".save-btn"),i=e.querySelector(".favorite-btn");s.addEventListener("click",(s=>{const i=s.target;i.classList.toggle("is-active"),b(JSON.parse(localStorage.getItem("user")),e,i,t,"saved")})),i.addEventListener("click",(s=>{const i=s.target;i.classList.toggle("is-active"),b(JSON.parse(localStorage.getItem("user")),e,i,t,"favorite")}))}async function b(e,t,s,i,a){s.classList.contains("is-active")?e[i][a].push(t.id):e[i][a]=e[i][a].filter((e=>e!==t.id)),async function(e,t){await fetch(`${c}/user/update`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)})}(e),localStorage.setItem("user",JSON.stringify(e)),function(){const e=document.querySelectorAll(".recipes__list"),t=document.querySelectorAll(".articles__list");e.forEach((e=>e.innerHTML="")),t.forEach((e=>e.innerHTML=""))}(),await async function(e){const t=f(e),s=t[0],i=t[1];await j(e,s,i)}(e),h(),M()}async function j(e,t,s){const i=document.querySelector("#empty-recipes-saved"),a=document.querySelector("#empty-recipes-favorite"),c=document.querySelector("#empty-articles-saved"),r=document.querySelector("#empty-articles-favorite");t.saved.queryOptions.id?.length?(p(await n(t.saved,o),t.saved,e),i.classList.add("hidden")):i.classList.remove("hidden"),t.favorite.queryOptions.id?.length?(p(await n(t.favorite,o),t.favorite,e),a.classList.add("hidden")):a.classList.remove("hidden"),s.saved.queryOptions.id?.length?(p(await n(s.saved,l),s.saved,e),c.classList.add("hidden")):c.classList.remove("hidden"),s.favorite.queryOptions.id?.length?(p(await n(s.favorite,l),s.favorite,e),r.classList.add("hidden")):r.classList.remove("hidden")}const I=e=>{e.target instanceof HTMLElement&&!e.target?.closest(".popup__content")&&e.target.closest(".popup")?.classList.remove("is-open")},w=e=>{const t=e.target,s=t.closest(".products-list__item"),i=t.closest(".products-list");i.removeChild(s),E(i)},D=e=>{const t=document.querySelector(".products-list_needed"),s=document.querySelector(".products-list_stocked"),i=e.target.closest(".products-list__item"),a=i.querySelector("span").innerText.toLowerCase().trim(),n=s.querySelectorAll(".product"),c=[];n.forEach((e=>{c.push(e.innerText.trim().toLowerCase())})),c.includes(a)?(t?.removeChild(i),E(t)):(t?.removeChild(i),s?.append(i),E(t),E(s))},E=e=>{0===e?.querySelectorAll(".products-list__item")?.length?e?.querySelector(".message")?.classList.remove("hidden"):e?.querySelector(".message")?.classList.add("hidden")},q=["apple","banana","tangerine","lemon","beef","citric acid","baking soda","pineapple","flour","onion","mango","rice","pasta","buckwheat","lemongrass"].sort(),A=e=>{const t=document.getElementById(e),s=t.querySelector(".products-input"),i=t.querySelector(".scrolling-area"),a=t.querySelector(".product-options"),n=t.parentElement.querySelector(".products-list");let c=q;function r(e,t){const s=function(e){const t=d("li","products-list__item");return t.innerHTML=`\n      <span class="product">${e}</span> \n      <div class="product__controls product-controls"> \n        <div class="product-controls__add-btn"></div> \n        <div class="product-controls__delete-btn"></div>\n      </div> \n    `,t.querySelector(".product-controls__delete-btn")?.addEventListener("click",(e=>{w(e),E(t.closest(".products-list"));const s=e.target.closest(".products-list__item")?.innerText.trim().toLowerCase();q.includes(s)&&!c.includes(s)&&(c.push(s),c.sort(),k(i,c))})),t.querySelector(".product-controls__add-btn")?.addEventListener("click",(e=>D(e))),t}(e);t.append(s),E(t)}E(n),k(i,c),s.addEventListener("click",(()=>{k(i,c),a.classList.add("is-active")})),document.body.addEventListener("click",(e=>{const t=e.target;t.classList.contains("product-options__item")||t.classList.contains("products-input")||a.classList.remove("is-active")})),s.addEventListener("keypress",(e=>{if("Enter"===e.key){const e=s.value.trim();r(e,n),c=c.filter((t=>t!==e.toLowerCase())),k(i,c),s.value="",a.classList.remove("is-active")}})),i.addEventListener("click",(e=>{const t=e.target;if(t.classList.contains("product-options__item")){const e=t.innerText;r(e,n),c=c.filter((t=>t!==e)),s.value="",k(i,c),s.focus()}})),s.addEventListener("input",(()=>{a.classList.add("is-active");const e=(t=c,n=s.value.trim().toLocaleLowerCase(),t.filter((e=>e.includes(n))));var t,n;e.length?k(i,e):("It seems like our recipes do not contain this product as ingredient, but you can add it to your shopping list",i.innerText="It seems like our recipes do not contain this product as ingredient, but you can add it to your shopping list")}))};function k(e,t){e.innerHTML="";const s=e.closest(".tabs-content__item").querySelectorAll(".products-list__item"),i=[];s.forEach((e=>{i.push(e.innerText)})),t.forEach((t=>{if(!i.includes(t)){const s=d("li","product-options__item");s.id=t,s.innerText=t,e.append(s)}}))}A("products-needed"),A("products-stocked"),async function(){return await(async()=>{const e=localStorage.getItem("token"),t=document.querySelector(".popup");if(e){const e=await fetch(`${c}/user/profile`,{credentials:"include"});if(200===e.status)return await e.json();t.classList.add("is-open")}else t.classList.add("is-open")})()}().then((e=>(function(e){document.querySelector(".profile").innerHTML=`\n    <div class="profile__general">\n      <div class="profile__avatar">\n        <img class="avatar__img" src=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik01MCA1MEM2MC4zNTUzIDUwIDY4Ljc1IDQxLjYwNTMgNjguNzUgMzEuMjVDNjguNzUgMjAuODk0NyA2MC4zNTUzIDEyLjUgNTAgMTIuNUMzOS42NDQ3IDEyLjUgMzEuMjUgMjAuODk0NyAzMS4yNSAzMS4yNUMzMS4yNSA0MS42MDUzIDM5LjY0NDcgNTAgNTAgNTBaTTYyLjUgMzEuMjVDNjIuNSAzOC4xNTM2IDU2LjkwMzYgNDMuNzUgNTAgNDMuNzVDNDMuMDk2NCA0My43NSAzNy41IDM4LjE1MzYgMzcuNSAzMS4yNUMzNy41IDI0LjM0NjQgNDMuMDk2NCAxOC43NSA1MCAxOC43NUM1Ni45MDM2IDE4Ljc1IDYyLjUgMjQuMzQ2NCA2Mi41IDMxLjI1WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTg3LjUgODEuMjVDODcuNSA4Ny41IDgxLjI1IDg3LjUgODEuMjUgODcuNUgxOC43NUMxOC43NSA4Ny41IDEyLjUgODcuNSAxMi41IDgxLjI1QzEyLjUgNzUgMTguNzUgNTYuMjUgNTAgNTYuMjVDODEuMjUgNTYuMjUgODcuNSA3NSA4Ny41IDgxLjI1Wk04MS4yNDk5IDgxLjIyODJDODEuMjQxIDc5LjY4NTggODAuMjg4OSA3NS4wNjUzIDc2LjA0OTMgNzAuODI1N0M3MS45NzI3IDY2Ljc0OTEgNjQuMzA2OSA2Mi41IDQ5Ljk5OTkgNjIuNUMzNS42OTMgNjIuNSAyOC4wMjcyIDY2Ljc0OTEgMjMuOTUwNiA3MC44MjU3QzE5LjcxMSA3NS4wNjUzIDE4Ljc1ODkgNzkuNjg1OCAxOC43NSA4MS4yMjgySDgxLjI0OTlaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K alt="avatar image">\n      </div>\n      <h1 class="profile__name">${e?.name||"User"}</h1>\n      <span class="profile__motto">I just love cooking and sharing my experience!</span>\n    </div>\n    <div class="profile__info">\n      <div class="info__item">Age: <span id="user-age">28</span></div>\n      <div class="info__item">Location: <span id="user-location">New-York</span></div>\n      <div class="info__item">\n        <div class="interests">Cooking interests:</div> \n        <div class="categories" id="fav-categories">\n          <div class="categories__item">Bakery</div>\n          <div class="categories__item">Vegan</div>\n          <div class="categories__item">Dinner</div>\n          <div class="categories__item">Healthy</div>\n        </div>\n      </div>\n    </div>\n  `}(e),f(e)))).then((e=>{e&&async function(e,t){const s=JSON.parse(localStorage.getItem("user")||"null");await j(s,e,t)}(e[0],e[1]).then((()=>L()))})),document.querySelector("#user-name").textContent=window.localStorage.userName||"User",e.addEventListener("click",(()=>{e.classList.toggle("burger_open"),t.classList.toggle("navbar__list_open"),e.classList.contains("burger_open")?(document.body.style.overflow="hidden",document.body.style.userSelect="none"):i()})),s.forEach((s=>{s.addEventListener("click",(()=>{e.classList.remove("burger_open"),t.classList.remove("navbar__list_open"),i()}))})),document.querySelector(".popup__body")?.addEventListener("click",I),a("recipes"),a("forms-container"),(()=>{const e=document.querySelectorAll(".product-controls__add-btn"),t=document.querySelectorAll(".product-controls__delete-btn");e.forEach((e=>{e.addEventListener("click",(e=>D(e)))})),t.forEach((e=>{e.addEventListener("click",(e=>w(e)))}))})()})();
//# sourceMappingURL=user.bundle.js.map