(()=>{"use strict";const e=document.querySelector(".burger"),t=document.querySelector(".navbar__list"),s=[...document.querySelectorAll(".nav__link")],i=e=>{const t=document.getElementById(e).querySelectorAll(".tabs-nav__item"),s=document.getElementById(e).querySelectorAll(".tabs-content__item");let i="";t.forEach((e=>e.addEventListener("click",(e=>n(e)))));const n=e=>{e.preventDefault(),t.forEach((e=>e.classList.remove("is-active")));const n=e.target.classList.contains("tabs-nav__item")?e.target:e.target.closest(".tabs-nav__item");var a;n?.classList.add("is-active"),s.forEach((e=>e.classList.remove("is-active"))),i=n?.getAttribute("data-tab-name"),a=i,s.forEach((e=>{e.getAttribute("data-tab-content")===a?e.classList.add("is-active"):e.classList.remove("is-active")}))}},n=async function(e,t){return await t(e.queryOptions)},a="https://rs-recipes-server.herokuapp.com",c=e=>{const t=[];for(const[s,i]of Object.entries(e))switch(typeof s){case"string":case"number":case"boolean":t.push(`${s}=${i}`);break;case"object":t.push(`${s}=${i.join(",")}`)}return"?"+t.join("&")},r=async e=>{let t="";e&&0!==Object.keys(e).length&&(t=c(e));const s=await fetch(`${a}/recipes/${t}`);return await s.json()},o=async e=>{let t="";e&&0!==Object.keys(e).length&&(t=c(e));const s=await fetch(`${a}/articles/${t}`);return await s.json()},l=function(e,...t){const s=document.createElement(e);return s.classList.add(...t),s},d=function(e,t,s){return e?[!!e[t].saved.find((e=>e===s)),!!e[t].favorite.find((e=>e===s))]:[!1,!1]};function u(e,t,s){const i=document.querySelector(`.${t.containerClass}`).querySelector(`.${t.listClass}`),n=function(e,t,s){return e.map(((e,i)=>"largeCardIndex"in t?function(e,t,s,i,n){const a=e.dishTypes[0].split(" ").map((e=>e[0].toUpperCase()+e.slice(1))).join(" ")||"",c=Math.round(e.nutrition.nutrients[0].amount),r=String(e.id),o=`./recipe.html?id=${r}`,[u,p]=d(n,"recipes",r),m="normal"===t?s.concat("card"):s.concat(["card","card_lg"]),v=l(i,...m);return v.id=r,v.innerHTML=`\n    <div class="card__header">\n      <p class="card__dish">${a}</p>\n      <div class="recipe__btns">\n        <button class="save-recipe btn-reset save-btn"></button>\n        <button class="favorite-recipe btn-reset favorite-btn"></button>\n      </div>\n    </div>\n    <a class="card__img" href="${o}">\n      <img class="card__img" src=${e.image} alt=${e.title}>\n    </a>\n    <a class="card-anchor" href=${o}>\n      <div class="card__meta">\n        <div class="data__time">\n          <p class="time__title">Cook time</p>\n          <p class="time__info">${e.readyInMinutes} min</p>\n        </div>\n        <div class="data__calories">\n          <p class="calories__title">Calories</p>\n          <p class="calories__info">${c} kcal</p>\n        </div>\n        <div class="data__rating">\n          <p class="rating__title">Rating</p>\n          <p class="rating__info">${e.aggregateLikes}</p>\n        </div>\n      </div>\n      <div class="card__body">\n        <h3 class="card__title">${e.title}</h3>\n        <p class="card__text">${e.summary}</p>\n      </div>\n    </a>\n  `,u&&v.querySelector(".save-recipe").classList.add("is-active"),p&&v.querySelector(".favorite-recipe").classList.add("is-active"),v}(e,i===t.largeCardIndex?"large":"normal",t.cardClassList,t.listElemType,s):function(e,t,s){const i=new Date(e.postedAt).toLocaleDateString("en-us",{year:"numeric",month:"long",day:"numeric"}),n=String(e._id),a=`./article.html?id=${n}`,[c,r]=d(s,"articles",n),o=l("article",...t);return o.id=e._id,o.innerHTML=`\n    <img class="article__img" src=${e.image} alt="article preview">\n    <div class="article__content">\n      <div class="article__header">\n        <time class="article__date" datetime=${e.postedAt}>${i}</time>\n        <div class="article__btns">\n          <button class="save-article btn-reset save-btn"></button>\n          <button class="favorite-article btn-reset favorite-btn"></button>\n        </div>\n      </div>\n      <h3 class="article__title">${e.title}</h3>\n      <p class="article__summary">${e.summary}</p>\n      <a class="article__btn btn-reset" href=${a}>contunue reading</a>\n    </div>\n  `,c&&o.querySelector(".save-article").classList.add("is-active"),r&&o.querySelector(".favorite-article").classList.add("is-active"),o}(e,t.articleClassList,s)))}(e,t,s);i.innerHTML="",i.append(...n)}const p=function(e){return document.cookie.split("; ").find((t=>t.startsWith(`${e}=`)))?.split("=")[1]};function m(e){window.localStorage.userName=e,document.querySelector("#user-name").textContent=e}function v(e){window.localStorage.setItem("user",JSON.stringify(e))}async function g(e){e.preventDefault();const t=e.target,s=function(e){if(e.password.value===e["password-confirm"].value)return e.querySelector("#password-mismatch").classList.add("hidden"),e.querySelector("#user-exist").classList.add("hidden"),new FormData(e);e.querySelector("#password-mismatch").classList.remove("hidden")}(e.target);if(void 0!==s){const e=await y(s,"/user/register");if(400===e.status)t.querySelector("#user-exist").classList.remove("hidden");else{document.querySelector(".popup").classList.remove("is-open"),alert("Registered successfully!"),t.reset();const s=await e.json();v(s),m(s.name)}}}async function _(e){e.preventDefault();const t=e.target,s=(i=e.target,new FormData(i));var i;const n=await y(s,"/user/login");switch(n.status){case 401:t.querySelector("#wrong-password").classList.remove("hidden"),t.querySelector("#user-not-found").classList.add("hidden");break;case 404:case 500:t.querySelector("#user-not-found").classList.remove("hidden"),t.querySelector("#wrong-password").classList.add("hidden");break;case 200:{document.querySelector(".popup").classList.remove("is-open"),alert("Logged in successfully!"),t.reset();const e=await n.json();v(e),m(e.name)}}}async function y(e,t){return await fetch(`${a}${t}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(Object.fromEntries(e.entries()))})}function f(e){if(void 0!==e)return[{saved:{containerClass:"recipes-saved",listClass:"recipes__list",listElemType:"li",cardClassList:["recipe__item"],queryOptions:{page:0,limit:10,id:e.recipes.saved},largeCardIndex:-1},favorite:{containerClass:"recipes-favorite",listClass:"recipes__list",listElemType:"li",cardClassList:["recipe__item"],queryOptions:{page:0,limit:10,id:e.recipes.favorite},largeCardIndex:-1}},{saved:{containerClass:"articles-saved",listClass:"articles__list",articleClassList:["article"],queryOptions:{page:0,limit:8,id:e.articles.saved}},favorite:{containerClass:"articles-favorite",listClass:"articles__list",articleClassList:["article"],queryOptions:{page:0,limit:8,id:e.articles.favorite}}}]}function L(){(()=>{const e=document.getElementById("userpage-controls").querySelectorAll(".tabs-btn"),t=document.querySelectorAll(".tabs");e.forEach((s=>{s.addEventListener("click",(()=>{e.forEach((e=>{e.classList.remove("btn-active")})),s.classList.add("btn-active");const n=s?.getAttribute("data-link-to");!function(e){t.forEach((t=>{t.id===e?t.classList.remove("hidden"):t.classList.add("hidden"),i(t.id)}))}(n)}))}))})(),S.addEventListener("click",(()=>async function(){204===(await fetch(`${a}/user/logout`,{credentials:"include"})).status&&(localStorage.removeItem("userName"),window.open("./index.html","_self"))}())),h(),M(),function(){const e=document.querySelector(".profile-btn"),t=document.querySelector(".popup");e.addEventListener("click",(async()=>{if(p("token")){const e=await fetch(`${a}/user/profile`,{credentials:"include"});200===e.status?(v(await e.json()),window.open("./user-page.html","_self")):t.classList.add("is-open")}else t.classList.add("is-open")}))}(),document.forms[1].addEventListener("submit",g),document.forms[0].addEventListener("submit",_)}const S=document.getElementById("logout-btn");function h(){document.querySelectorAll(".article").forEach((e=>{N(e,"articles")}))}function M(){document.querySelectorAll(".card").forEach((e=>{N(e,"recipes")}))}function N(e,t){const s=e.querySelector(".save-btn"),i=e.querySelector(".favorite-btn");s.addEventListener("click",(s=>{const i=s.target;i.classList.toggle("is-active"),b(JSON.parse(localStorage.getItem("user")),e,i,t,"saved")})),i.addEventListener("click",(s=>{const i=s.target;i.classList.toggle("is-active"),b(JSON.parse(localStorage.getItem("user")),e,i,t,"favorite")}))}async function b(e,t,s,i,n){s.classList.contains("is-active")?e[i][n].push(t.id):e[i][n]=e[i][n].filter((e=>e!==t.id)),async function(e,t){await fetch(`${a}/user/update`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)})}(e),localStorage.setItem("user",JSON.stringify(e)),function(){const e=document.querySelectorAll(".recipes__list"),t=document.querySelectorAll(".articles__list");e.forEach((e=>e.innerHTML="")),t.forEach((e=>e.innerHTML=""))}(),await async function(e){const t=f(e),s=t[0],i=t[1];await j(e,s,i)}(e),h(),M()}async function j(e,t,s){const i=document.querySelector("#empty-recipes-saved"),a=document.querySelector("#empty-recipes-favorite"),c=document.querySelector("#empty-articles-saved"),l=document.querySelector("#empty-articles-favorite");t.saved.queryOptions.id?.length?(u(await n(t.saved,r),t.saved,e),i.classList.add("hidden")):i.classList.remove("hidden"),t.favorite.queryOptions.id?.length?(u(await n(t.favorite,r),t.favorite,e),a.classList.add("hidden")):a.classList.remove("hidden"),s.saved.queryOptions.id?.length?(u(await n(s.saved,o),s.saved,e),c.classList.add("hidden")):c.classList.remove("hidden"),s.favorite.queryOptions.id?.length?(u(await n(s.favorite,o),s.favorite,e),l.classList.add("hidden")):l.classList.remove("hidden")}const D=e=>{e.target instanceof HTMLElement&&!e.target?.closest(".popup__content")&&e.target.closest(".popup")?.classList.remove("is-open")},w=e=>{const t=e.target,s=t.closest(".products-list__item"),i=t.closest(".products-list");i.removeChild(s),I(i)},E=e=>{const t=document.querySelector(".products-list_needed"),s=document.querySelector(".products-list_stocked"),i=e.target.closest(".products-list__item"),n=i.querySelector("span").innerText.toLowerCase().trim(),a=s.querySelectorAll(".product"),c=[];a.forEach((e=>{c.push(e.innerText.trim().toLowerCase())})),c.includes(n)?(t?.removeChild(i),I(t)):(t?.removeChild(i),s?.append(i),I(t),I(s))},I=e=>{0===e?.querySelectorAll(".products-list__item")?.length?e?.querySelector(".message")?.classList.remove("hidden"):e?.querySelector(".message")?.classList.add("hidden")},q=["apple","banana","tangerine","lemon","beef","citric acid","baking soda","pineapple","flour","onion","mango","rice","pasta","buckwheat","lemongrass"].sort(),A=e=>{const t=document.getElementById(e),s=t.querySelector(".products-input"),i=t.querySelector(".scrolling-area"),n=t.querySelector(".product-options"),a=t.parentElement.querySelector(".products-list");let c=q;function r(e,t){const s=function(e){const t=l("li","products-list__item");return t.innerHTML=`\n      <span class="product">${e}</span> \n      <div class="product__controls product-controls"> \n        <div class="product-controls__add-btn"></div> \n        <div class="product-controls__delete-btn"></div>\n      </div> \n    `,t.querySelector(".product-controls__delete-btn")?.addEventListener("click",(e=>{w(e),I(t.closest(".products-list"));const s=e.target.closest(".products-list__item")?.innerText.trim().toLowerCase();q.includes(s)&&!c.includes(s)&&(c.push(s),c.sort(),C(i,c))})),t.querySelector(".product-controls__add-btn")?.addEventListener("click",(e=>E(e))),t}(e);t.append(s),I(t)}I(a),C(i,c),s.addEventListener("click",(()=>{C(i,c),n.classList.add("is-active")})),document.body.addEventListener("click",(e=>{const t=e.target;t.classList.contains("product-options__item")||t.classList.contains("products-input")||n.classList.remove("is-active")})),s.addEventListener("keypress",(e=>{if("Enter"===e.key){const e=s.value.trim();r(e,a),c=c.filter((t=>t!==e.toLowerCase())),C(i,c),s.value="",n.classList.remove("is-active")}})),i.addEventListener("click",(e=>{const t=e.target;if(t.classList.contains("product-options__item")){const e=t.innerText;r(e,a),c=c.filter((t=>t!==e)),s.value="",C(i,c),s.focus()}})),s.addEventListener("input",(()=>{n.classList.add("is-active");const e=(t=c,a=s.value.trim().toLocaleLowerCase(),t.filter((e=>e.includes(a))));var t,a;e.length?C(i,e):("It seems like our recipes do not contain this product as ingredient, but you can add it to your shopping list",i.innerText="It seems like our recipes do not contain this product as ingredient, but you can add it to your shopping list")}))};function C(e,t){e.innerHTML="";const s=e.closest(".tabs-content__item").querySelectorAll(".products-list__item"),i=[];s.forEach((e=>{i.push(e.innerText)})),t.forEach((t=>{if(!i.includes(t)){const s=l("li","product-options__item");s.id=t,s.innerText=t,e.append(s)}}))}A("products-needed"),A("products-stocked"),async function(){return await(async()=>{const e=p("token"),t=document.querySelector(".popup");if(e){const e=await fetch(`${a}/user/profile`,{credentials:"include"});if(200===e.status)return await e.json();t.classList.add("is-open")}else t.classList.add("is-open")})()}().then((e=>(function(e){document.querySelector(".profile").innerHTML=`\n    <div class="profile__general">\n      <div class="profile__avatar">\n        <img class="avatar__img" src=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik01MCA1MEM2MC4zNTUzIDUwIDY4Ljc1IDQxLjYwNTMgNjguNzUgMzEuMjVDNjguNzUgMjAuODk0NyA2MC4zNTUzIDEyLjUgNTAgMTIuNUMzOS42NDQ3IDEyLjUgMzEuMjUgMjAuODk0NyAzMS4yNSAzMS4yNUMzMS4yNSA0MS42MDUzIDM5LjY0NDcgNTAgNTAgNTBaTTYyLjUgMzEuMjVDNjIuNSAzOC4xNTM2IDU2LjkwMzYgNDMuNzUgNTAgNDMuNzVDNDMuMDk2NCA0My43NSAzNy41IDM4LjE1MzYgMzcuNSAzMS4yNUMzNy41IDI0LjM0NjQgNDMuMDk2NCAxOC43NSA1MCAxOC43NUM1Ni45MDM2IDE4Ljc1IDYyLjUgMjQuMzQ2NCA2Mi41IDMxLjI1WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTg3LjUgODEuMjVDODcuNSA4Ny41IDgxLjI1IDg3LjUgODEuMjUgODcuNUgxOC43NUMxOC43NSA4Ny41IDEyLjUgODcuNSAxMi41IDgxLjI1QzEyLjUgNzUgMTguNzUgNTYuMjUgNTAgNTYuMjVDODEuMjUgNTYuMjUgODcuNSA3NSA4Ny41IDgxLjI1Wk04MS4yNDk5IDgxLjIyODJDODEuMjQxIDc5LjY4NTggODAuMjg4OSA3NS4wNjUzIDc2LjA0OTMgNzAuODI1N0M3MS45NzI3IDY2Ljc0OTEgNjQuMzA2OSA2Mi41IDQ5Ljk5OTkgNjIuNUMzNS42OTMgNjIuNSAyOC4wMjcyIDY2Ljc0OTEgMjMuOTUwNiA3MC44MjU3QzE5LjcxMSA3NS4wNjUzIDE4Ljc1ODkgNzkuNjg1OCAxOC43NSA4MS4yMjgySDgxLjI0OTlaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K alt="avatar image">\n      </div>\n      <h1 class="profile__name">${e?.name||"User"}</h1>\n      <span class="profile__motto">I just love cooking and sharing my experience!</span>\n    </div>\n    <div class="profile__info">\n      <div class="info__item">Age: <span id="user-age">28</span></div>\n      <div class="info__item">Location: <span id="user-location">New-York</span></div>\n      <div class="info__item">\n        <div class="interests">Cooking interests:</div> \n        <div class="categories" id="fav-categories">\n          <div class="categories__item">Bakery</div>\n          <div class="categories__item">Vegan</div>\n          <div class="categories__item">Dinner</div>\n          <div class="categories__item">Healthy</div>\n        </div>\n      </div>\n    </div>\n  `}(e),f(e)))).then((e=>{e&&async function(e,t){const s=JSON.parse(localStorage.getItem("user")||"null");await j(s,e,t)}(e[0],e[1]).then((()=>L()))})),document.querySelector("#user-name").textContent=window.localStorage.userName||"User",e.addEventListener("click",(()=>{e.classList.toggle("burger_open"),t.classList.toggle("navbar__list_open")})),s.forEach((s=>{s.addEventListener("click",(()=>{e.classList.remove("burger_open"),t.classList.remove("navbar__list_open")}))})),document.querySelector(".popup__body")?.addEventListener("click",D),i("recipes"),i("forms-container"),(()=>{const e=document.querySelectorAll(".product-controls__add-btn"),t=document.querySelectorAll(".product-controls__delete-btn");e.forEach((e=>{e.addEventListener("click",(e=>E(e)))})),t.forEach((e=>{e.addEventListener("click",(e=>w(e)))}))})()})();
//# sourceMappingURL=user.bundle.js.map