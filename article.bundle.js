(()=>{"use strict";const e=document.querySelector(".burger"),t=document.querySelector(".navbar__list"),s=[...document.querySelectorAll(".nav__link")];function n(){document.body.style.overflow="auto",document.body.style.userSelect="auto"}const a="https://rs-recipes-server.herokuapp.com",i=function(e,...t){const s=document.createElement(e);return s.classList.add(...t),s},c=function(e,t,s){return e?[!!e[t].saved.find((e=>e===s)),!!e[t].favorite.find((e=>e===s))]:[!1,!1]};function r(e,t){if(void 0===e)return null;const s=document.createElement("div"),n=e.map((e=>{const s=i("li",t);return s.innerHTML=e,s}));return s.append(...n),s}function o(e,t){const s=e.querySelector(".save-btn"),n=e.querySelector(".favorite-btn");s.addEventListener("click",(s=>{const n=s.target;n.classList.toggle("is-active");const a=JSON.parse(localStorage.getItem("user")||"null");a&&l(a,e,n,t,"saved")})),n.addEventListener("click",(s=>{const n=s.target;n.classList.toggle("is-active");const a=JSON.parse(localStorage.getItem("user")||"null");a&&l(a,e,n,t,"favorite")}))}function l(e,t,s,n,i){s.classList.contains("is-active")?e[n][i].push(t.id):e[n][i]=e[n][i].filter((e=>e!==t.id)),async function(e,t){await fetch(`${a}/user/update`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)})}(e),localStorage.setItem("user",JSON.stringify(e))}function d(e){window.localStorage.userName=e,document.querySelector("#user-name").textContent=e}function u(e){window.localStorage.setItem("user",JSON.stringify(e))}async function m(e){e.preventDefault();const t=e.target,s=function(e){if(e.password.value===e["password-confirm"].value)return e.querySelector("#password-mismatch").classList.add("hidden"),e.querySelector("#user-exist").classList.add("hidden"),new FormData(e);e.querySelector("#password-mismatch").classList.remove("hidden")}(e.target);if(void 0!==s){const e=await v(s,"/user/register");if(400===e.status)t.querySelector("#user-exist").classList.remove("hidden");else{document.querySelector(".popup").classList.remove("is-open"),alert("Registered successfully!"),localStorage.setItem("token","true"),t.reset();const s=await e.json();u(s),d(s.name)}}}async function p(e){e.preventDefault();const t=e.target,s=(n=e.target,new FormData(n));var n;const a=await v(s,"/user/login");switch(a.status){case 401:t.querySelector("#wrong-password").classList.remove("hidden"),t.querySelector("#user-not-found").classList.add("hidden");break;case 404:case 500:t.querySelector("#user-not-found").classList.remove("hidden"),t.querySelector("#wrong-password").classList.add("hidden");break;case 200:{document.querySelector(".popup").classList.remove("is-open"),alert("Logged in successfully!"),localStorage.setItem("token","true"),t.reset();const e=await a.json();u(e),d(e.name)}}}async function v(e,t){return await fetch(`${a}${t}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(Object.fromEntries(e.entries()))})}const _=JSON.parse(localStorage.getItem("user")||"null");const g=e=>{e.target instanceof HTMLElement&&!e.target?.closest(".popup__content")&&e.target.closest(".popup")?.classList.remove("is-open")},f=window.location.search,y=new URLSearchParams(f).get("id");e.addEventListener("click",(()=>{e.classList.toggle("burger_open"),t.classList.toggle("navbar__list_open"),e.classList.contains("burger_open")?(document.body.style.overflow="hidden",document.body.style.userSelect="none"):n()})),s.forEach((s=>{s.addEventListener("click",(()=>{e.classList.remove("burger_open"),t.classList.remove("navbar__list_open"),n()}))})),async function(e){const t=await(async e=>{const t=await fetch(`${a}/articles/${e}`);return await t.json()})(e);(function(e,t){const s=document.querySelector("#main"),n=document.createElement("section"),a=new Date(e.postedAt).toLocaleDateString("en-us",{year:"numeric",month:"long",day:"numeric"}),i=String(e._id),[o,l]=c(t,"articles",i),d=r(e.category,"categories__item"),u=r(e.body,"article__text");n.innerHTML=`\n    <div class="container article-container" id=${i}>\n      <div class="article__btns">\n        <button class="article__btn_favorite btn_outlined btn-reset favorite-btn">Add to favorite articles</button>\n        <button class="article__btn_save btn_outlined btn-reset save-btn">Save for later</button>\n      </div>\n      <h1 class="article-main__title">${e.title}</h1>\n      <img class="article-main__img" src=${e.image} alt="article img">\n      <div class="article__meta">\n        <time class="article__date" datetime=${e.postedAt}>${a}</time>\n        <ul class="article__categories list-reset">\n          ${d?.innerHTML}\n        </ul>\n      </div>\n      <div class="article__descr">\n        ${u?.innerHTML}\n      </div>\n    </div>\n  `,o&&n.querySelector(".save-btn").classList.add("is-active"),l&&n.querySelector(".favorite-btn").classList.add("is-active"),s.appendChild(n)})(t,_),t.relevantRecipes.length>0&&function(e,t){const s=document.querySelector("#main"),n=i("section","relevant-recipes");n.innerHTML='\n    <div class="container">\n      <h2 class="relevant-recipes__title">Relevant recipes</h2>\n      <ul class="relevant-recipes__list list-reset">\n      </ul>\n    </div>\n  ';const a=n.querySelector(".relevant-recipes__list"),r=e.map((e=>function(e,t,s,n,a){const r=e.dishTypes[0].split(" ").map((e=>e[0].toUpperCase()+e.slice(1))).join(" ")||"",o=Math.round(e.nutrition.nutrients[0].amount),l=String(e.id),d=`./recipe.html?id=${l}`,[u,m]=c(a,"recipes",l),p="normal"===t?s.concat("card"):s.concat(["card","card_lg"]),v=i(n,...p);return v.id=l,v.innerHTML=`\n    <div class="card__header">\n      <p class="card__dish">${r}</p>\n      <div class="recipe__btns">\n        <button class="save-recipe btn-reset save-btn"></button>\n        <button class="favorite-recipe btn-reset favorite-btn"></button>\n      </div>\n    </div>\n    <a class="card__img" href="${d}">\n      <img class="card__img" src=${e.image} alt=${e.title}>\n    </a>\n    <a class="card-anchor" href=${d}>\n      <div class="card__meta">\n        <div class="data__time">\n          <p class="time__title">Cook time</p>\n          <p class="time__info">${e.readyInMinutes} min</p>\n        </div>\n        <div class="data__calories">\n          <p class="calories__title">Calories</p>\n          <p class="calories__info">${o} kcal</p>\n        </div>\n        <div class="data__rating">\n          <p class="rating__title">Rating</p>\n          <p class="rating__info">${e.aggregateLikes}</p>\n        </div>\n      </div>\n      <div class="card__body">\n        <h3 class="card__title">${e.title}</h3>\n        <p class="card__text">${e.summary}</p>\n      </div>\n    </a>\n  `,u&&v.querySelector(".save-recipe").classList.add("is-active"),m&&v.querySelector(".favorite-recipe").classList.add("is-active"),v}(e,"normal",["recipe__item"],"li",t)));a.append(...r),s.appendChild(n)}(await Promise.all(t.relevantRecipes.map((async e=>await(async e=>{const t=await fetch(`${a}/recipes/${e}`);return await t.json()})(String(e))))),_)}(y).then((()=>(o(document.querySelector(".article-container"),"articles"),document.querySelectorAll(".card").forEach((e=>{o(e,"recipes")})),function(){const e=document.querySelector(".profile-btn"),t=document.querySelector(".popup");e.addEventListener("click",(async()=>{if(localStorage.getItem("token")){const e=await fetch(`${a}/user/profile`,{credentials:"include"});200===e.status?(u(await e.json()),window.open("./user-page.html","_self")):t.classList.add("is-open")}else t.classList.add("is-open")}))}(),document.forms[1].addEventListener("submit",m),void document.forms[0].addEventListener("submit",p)))),document.querySelector("#user-name").textContent=window.localStorage.userName||"User",document.querySelector(".popup__body")?.addEventListener("click",g),(e=>{const t=document.getElementById(e).querySelectorAll(".tabs-nav__item"),s=document.getElementById(e).querySelectorAll(".tabs-content__item");let n="";t.forEach((e=>e.addEventListener("click",(e=>a(e)))));const a=e=>{e.preventDefault(),t.forEach((e=>e.classList.remove("is-active")));const a=e.target.classList.contains("tabs-nav__item")?e.target:e.target.closest(".tabs-nav__item");var i;a?.classList.add("is-active"),s.forEach((e=>e.classList.remove("is-active"))),n=a?.getAttribute("data-tab-name"),i=n,s.forEach((e=>{e.getAttribute("data-tab-content")===i?e.classList.add("is-active"):e.classList.remove("is-active")}))}})("forms-container")})();
//# sourceMappingURL=article.bundle.js.map