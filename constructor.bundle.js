(()=>{"use strict";const e=document.querySelector(".burger"),t=document.querySelector(".navbar__list"),n=[...document.querySelectorAll(".nav__link")];function s(){document.body.style.overflow="auto",document.body.style.userSelect="auto"}const o=function(e,...t){const n=document.createElement(e);return n.classList.add(...t),n},r=["apple","banana","tangerine","lemon","beef","citric acid","baking soda","pineapple","flour","onion","mango","rice","pasta","buckwheat","lemongrass"].sort(),c="https://rs-recipes-server.herokuapp.com";function i(e){window.localStorage.userName=e,document.querySelector("#user-name").textContent=e}function a(e){window.localStorage.setItem("user",JSON.stringify(e))}async function d(e,t){return await fetch(`${c}${t}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(Object.fromEntries(e.entries()))})}const l=e=>{e.target instanceof HTMLElement&&!e.target?.closest(".popup__content")&&e.target.closest(".popup")?.classList.remove("is-open")};let u=r;const m=document.getElementById("constructor-input"),p=document.querySelector(".ingredient-options"),g=document.getElementById("relevant-options"),v=document.getElementById("chosen-ingredients"),y=document.getElementById("is-empty-message");function f(e){g.innerHTML="",e.forEach((e=>{const t=o("li","ingredient-options__item");t.id=e,t.innerText=e,g.append(t)}))}function L(e){const t=e.trim().toLowerCase();r.includes(t)&&(function(e){const t=o("div","constructor-ingredients__item","constructor-ingredient");t.innerHTML=`\n    <span class="constructor-ingredient__name">${e}</span>\n    <div class="constructor-ingredient__delete"></div>\n  `,v.append(t)}(t),h()),u=u.filter((e=>e!==t)),m.value="",f(u),m.focus()}function _(){y.classList.remove("hidden")}function h(){y.classList.add("hidden")}y.innerText="You haven't added anything yet...",e.addEventListener("click",(()=>{e.classList.toggle("burger_open"),t.classList.toggle("navbar__list_open"),e.classList.contains("burger_open")?(document.body.style.overflow="hidden",document.body.style.userSelect="none"):s()})),n.forEach((n=>{n.addEventListener("click",(()=>{e.classList.remove("burger_open"),t.classList.remove("navbar__list_open"),s()}))})),_(),document.querySelector("#user-name").textContent=window.localStorage.userName||"User",v.addEventListener("click",(e=>{if(e.target.classList.contains("constructor-ingredient__delete")){const n=e.target.closest(".constructor-ingredient");n&&(t=n,v.removeChild(t),function(e){const t=e.querySelector(".constructor-ingredient__name").innerText;u.push(t),u.sort()}(n))}var t;0===v.querySelectorAll(".constructor-ingredient").length?_():h()})),m.addEventListener("click",(()=>{f(u),p.classList.add("is-active")})),m.addEventListener("input",(()=>{p.classList.add("is-active");const e=(t=u,n=m.value.trim().toLocaleLowerCase(),t.filter((e=>e.includes(n))));var t,n;e.length?f(e):("Sorry, nothing matches",g.innerText="Sorry, nothing matches")})),document.body.addEventListener("click",(e=>{const t=e.target;t.classList.contains("ingredient-options__item")||"constructor-input"===t.id||p.classList.remove("is-active")})),m.addEventListener("keypress",(e=>{"Enter"===e.key&&L(m.value)})),g.addEventListener("click",(e=>{const t=e.target;t.classList.contains("ingredient-options__item")&&L(t.innerText)})),f(r),document.querySelector(".popup__body")?.addEventListener("click",l),(e=>{const t=document.getElementById(e).querySelectorAll(".tabs-nav__item"),n=document.getElementById(e).querySelectorAll(".tabs-content__item");let s="";t.forEach((e=>e.addEventListener("click",(e=>o(e)))));const o=e=>{e.preventDefault(),t.forEach((e=>e.classList.remove("is-active")));const o=e.target.classList.contains("tabs-nav__item")?e.target:e.target.closest(".tabs-nav__item");var r;o?.classList.add("is-active"),n.forEach((e=>e.classList.remove("is-active"))),s=o?.getAttribute("data-tab-name"),r=s,n.forEach((e=>{e.getAttribute("data-tab-content")===r?e.classList.add("is-active"):e.classList.remove("is-active")}))}})("forms-container"),function(){const e=document.querySelector(".profile-btn"),t=document.querySelector(".popup");e.addEventListener("click",(async()=>{if(localStorage.getItem("token")){const e=await fetch(`${c}/user/profile`,{credentials:"include"});200===e.status?(a(await e.json()),window.open("./user-page.html","_self")):t.classList.add("is-open")}else t.classList.add("is-open")}))}(),document.forms[1].addEventListener("submit",(async function(e){e.preventDefault();const t=e.target,n=function(e){if(e.password.value===e["password-confirm"].value)return e.querySelector("#password-mismatch").classList.add("hidden"),e.querySelector("#user-exist").classList.add("hidden"),new FormData(e);e.querySelector("#password-mismatch").classList.remove("hidden")}(e.target);if(void 0!==n){const e=await d(n,"/user/register");if(400===e.status)t.querySelector("#user-exist").classList.remove("hidden");else{document.querySelector(".popup").classList.remove("is-open"),alert("Registered successfully!"),localStorage.setItem("token","true"),t.reset();const n=await e.json();a(n),i(n.name)}}})),document.forms[0].addEventListener("submit",(async function(e){e.preventDefault();const t=e.target,n=(s=e.target,new FormData(s));var s;const o=await d(n,"/user/login");switch(o.status){case 401:t.querySelector("#wrong-password").classList.remove("hidden"),t.querySelector("#user-not-found").classList.add("hidden");break;case 404:case 500:t.querySelector("#user-not-found").classList.remove("hidden"),t.querySelector("#wrong-password").classList.add("hidden");break;case 200:{document.querySelector(".popup").classList.remove("is-open"),alert("Logged in successfully!"),localStorage.setItem("token","true"),t.reset();const e=await o.json();a(e),i(e.name)}}}))})();
//# sourceMappingURL=constructor.bundle.js.map