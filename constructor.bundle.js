(()=>{"use strict";const e=document.querySelector(".burger"),t=document.querySelector(".navbar__list"),n=[...document.querySelectorAll(".nav__link")],s=function(e,...t){const n=document.createElement(e);return n.classList.add(...t),n},r=["apple","banana","tangerine","lemon","beef","citric acid","baking soda","pineapple","flour","onion","mango","rice","pasta","buckwheat","lemongrass"].sort(),i="https://rs-recipes-server.herokuapp.com";function o(e){window.localStorage.userName=e,document.querySelector("#user-name").textContent=e}function c(e){window.localStorage.setItem("user",JSON.stringify(e))}async function a(e,t){return await fetch(`${i}${t}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(Object.fromEntries(e.entries()))})}let d=r;const l=document.getElementById("constructor-input"),u=document.querySelector(".ingredient-options"),m=document.getElementById("relevant-options"),p=document.getElementById("chosen-ingredients"),g=document.getElementById("is-empty-message");function v(e){m.innerHTML="",e.forEach((e=>{const t=s("li","ingredient-options__item");t.id=e,t.innerText=e,m.append(t)}))}function f(e){const t=e.trim().toLowerCase();r.includes(t)&&(function(e){const t=s("div","constructor-ingredients__item","constructor-ingredient");t.innerHTML=`\n    <span class="constructor-ingredient__name">${e}</span>\n    <div class="constructor-ingredient__delete"></div>\n  `,p.append(t)}(t),L()),d=d.filter((e=>e!==t)),l.value="",v(d),l.focus()}function y(){g.classList.remove("hidden")}function L(){g.classList.add("hidden")}g.innerText="You haven't added anything yet...",e.addEventListener("click",(()=>{e.classList.toggle("burger_open"),t.classList.toggle("navbar__list_open")})),n.forEach((n=>{n.addEventListener("click",(()=>{e.classList.remove("burger_open"),t.classList.remove("navbar__list_open")}))})),y(),document.querySelector("#user-name").textContent=window.localStorage.userName||"User",p.addEventListener("click",(e=>{if(e.target.classList.contains("constructor-ingredient__delete")){const n=e.target.closest(".constructor-ingredient");n&&(t=n,p.removeChild(t),function(e){const t=e.querySelector(".constructor-ingredient__name").innerText;d.push(t),d.sort()}(n))}var t;0===p.querySelectorAll(".constructor-ingredient").length?y():L()})),l.addEventListener("click",(()=>{v(d),u.classList.add("is-active")})),l.addEventListener("input",(()=>{u.classList.add("is-active");const e=(t=d,n=l.value.trim().toLocaleLowerCase(),t.filter((e=>e.includes(n))));var t,n;e.length?v(e):("Sorry, nothing matches",m.innerText="Sorry, nothing matches")})),document.body.addEventListener("click",(e=>{const t=e.target;t.classList.contains("ingredient-options__item")||"constructor-input"===t.id||u.classList.remove("is-active")})),l.addEventListener("keypress",(e=>{"Enter"===e.key&&f(l.value)})),m.addEventListener("click",(e=>{const t=e.target;t.classList.contains("ingredient-options__item")&&f(t.innerText)})),v(r),function(){const e=document.querySelector(".profile-btn"),t=document.querySelector(".popup");e.addEventListener("click",(async()=>{if(e="token",document.cookie.split("; ").find((t=>t.startsWith(`${e}=`)))?.split("=")[1]){const e=await fetch(`${i}/user/profile`,{credentials:"include"});200===e.status?(c(await e.json()),window.open("./user-page.html","_self")):t.classList.add("is-open")}else t.classList.add("is-open");var e}))}(),document.forms[1].addEventListener("submit",(async function(e){e.preventDefault();const t=e.target,n=function(e){if(e.password.value===e["password-confirm"].value)return e.querySelector("#password-mismatch").classList.add("hidden"),e.querySelector("#user-exist").classList.add("hidden"),new FormData(e);e.querySelector("#password-mismatch").classList.remove("hidden")}(e.target);if(void 0!==n){const e=await a(n,"/user/register");if(400===e.status)t.querySelector("#user-exist").classList.remove("hidden");else{document.querySelector(".popup").classList.remove("is-open"),alert("Registered successfully!"),t.reset();const n=await e.json();c(n),o(n.name)}}})),document.forms[0].addEventListener("submit",(async function(e){e.preventDefault();const t=e.target,n=(s=e.target,new FormData(s));var s;const r=await a(n,"/user/login");switch(r.status){case 401:t.querySelector("#wrong-password").classList.remove("hidden"),t.querySelector("#user-not-found").classList.add("hidden");break;case 404:case 500:t.querySelector("#user-not-found").classList.remove("hidden"),t.querySelector("#wrong-password").classList.add("hidden");break;case 200:{document.querySelector(".popup").classList.remove("is-open"),alert("Logged in successfully!"),t.reset();const e=await r.json();c(e),o(e.name)}}}))})();
//# sourceMappingURL=constructor.bundle.js.map