(()=>{"use strict";const e=document.querySelector(".burger"),t=document.querySelector(".navbar__list"),n=[...document.querySelectorAll(".nav__link")],s=function(e,...t){const n=document.createElement(e);return n.classList.add(...t),n},o=["apple","banana","tangerine","lemon","beef","citric acid","baking soda","pineapple","flour","onion","mango","rice","pasta","buckwheat","lemongrass"].sort(),r="https://rs-recipes-server.herokuapp.com";function i(e){window.localStorage.userName=e,document.querySelector("#user-name").textContent=e}function c(e){window.localStorage.setItem("user",JSON.stringify(e))}async function a(e,t){return await fetch(`${r}${t}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(Object.fromEntries(e.entries()))})}const d=e=>{e.target instanceof HTMLElement&&!e.target?.closest(".popup__content")&&e.target.closest(".popup")?.classList.remove("is-open")};let l=o;const u=document.getElementById("constructor-input"),m=document.querySelector(".ingredient-options"),p=document.getElementById("relevant-options"),g=document.getElementById("chosen-ingredients"),v=document.getElementById("is-empty-message");function L(e){p.innerHTML="",e.forEach((e=>{const t=s("li","ingredient-options__item");t.id=e,t.innerText=e,p.append(t)}))}function f(e){const t=e.trim().toLowerCase();o.includes(t)&&(function(e){const t=s("div","constructor-ingredients__item","constructor-ingredient");t.innerHTML=`\n    <span class="constructor-ingredient__name">${e}</span>\n    <div class="constructor-ingredient__delete"></div>\n  `,g.append(t)}(t),_()),l=l.filter((e=>e!==t)),u.value="",L(l),u.focus()}function y(){v.classList.remove("hidden")}function _(){v.classList.add("hidden")}v.innerText="You haven't added anything yet...",e.addEventListener("click",(()=>{e.classList.toggle("burger_open"),t.classList.toggle("navbar__list_open")})),n.forEach((n=>{n.addEventListener("click",(()=>{e.classList.remove("burger_open"),t.classList.remove("navbar__list_open")}))})),y(),document.querySelector("#user-name").textContent=window.localStorage.userName||"User",g.addEventListener("click",(e=>{if(e.target.classList.contains("constructor-ingredient__delete")){const n=e.target.closest(".constructor-ingredient");n&&(t=n,g.removeChild(t),function(e){const t=e.querySelector(".constructor-ingredient__name").innerText;l.push(t),l.sort()}(n))}var t;0===g.querySelectorAll(".constructor-ingredient").length?y():_()})),u.addEventListener("click",(()=>{L(l),m.classList.add("is-active")})),u.addEventListener("input",(()=>{m.classList.add("is-active");const e=(t=l,n=u.value.trim().toLocaleLowerCase(),t.filter((e=>e.includes(n))));var t,n;e.length?L(e):("Sorry, nothing matches",p.innerText="Sorry, nothing matches")})),document.body.addEventListener("click",(e=>{const t=e.target;t.classList.contains("ingredient-options__item")||"constructor-input"===t.id||m.classList.remove("is-active")})),u.addEventListener("keypress",(e=>{"Enter"===e.key&&f(u.value)})),p.addEventListener("click",(e=>{const t=e.target;t.classList.contains("ingredient-options__item")&&f(t.innerText)})),L(o),document.querySelector(".popup__body")?.addEventListener("click",d),(e=>{const t=document.getElementById(e).querySelectorAll(".tabs-nav__item"),n=document.getElementById(e).querySelectorAll(".tabs-content__item");let s="";t.forEach((e=>e.addEventListener("click",(e=>o(e)))));const o=e=>{e.preventDefault(),t.forEach((e=>e.classList.remove("is-active")));const o=e.target.classList.contains("tabs-nav__item")?e.target:e.target.closest(".tabs-nav__item");var r;o?.classList.add("is-active"),n.forEach((e=>e.classList.remove("is-active"))),s=o?.getAttribute("data-tab-name"),r=s,n.forEach((e=>{e.getAttribute("data-tab-content")===r?e.classList.add("is-active"):e.classList.remove("is-active")}))}})("forms-container"),function(){const e=document.querySelector(".profile-btn"),t=document.querySelector(".popup");e.addEventListener("click",(async()=>{if(localStorage.getItem("token")){const e=await fetch(`${r}/user/profile`,{credentials:"include"});200===e.status?(c(await e.json()),window.open("./user-page.html","_self")):t.classList.add("is-open")}else t.classList.add("is-open")}))}(),document.forms[1].addEventListener("submit",(async function(e){e.preventDefault();const t=e.target,n=function(e){if(e.password.value===e["password-confirm"].value)return e.querySelector("#password-mismatch").classList.add("hidden"),e.querySelector("#user-exist").classList.add("hidden"),new FormData(e);e.querySelector("#password-mismatch").classList.remove("hidden")}(e.target);if(void 0!==n){const e=await a(n,"/user/register");if(400===e.status)t.querySelector("#user-exist").classList.remove("hidden");else{document.querySelector(".popup").classList.remove("is-open"),alert("Registered successfully!"),localStorage.setItem("token","true"),t.reset();const n=await e.json();c(n),i(n.name)}}})),document.forms[0].addEventListener("submit",(async function(e){e.preventDefault();const t=e.target,n=(s=e.target,new FormData(s));var s;const o=await a(n,"/user/login");switch(o.status){case 401:t.querySelector("#wrong-password").classList.remove("hidden"),t.querySelector("#user-not-found").classList.add("hidden");break;case 404:case 500:t.querySelector("#user-not-found").classList.remove("hidden"),t.querySelector("#wrong-password").classList.add("hidden");break;case 200:{document.querySelector(".popup").classList.remove("is-open"),alert("Logged in successfully!"),localStorage.setItem("token","true"),t.reset();const e=await o.json();c(e),i(e.name)}}}))})();
//# sourceMappingURL=constructor.bundle.js.map